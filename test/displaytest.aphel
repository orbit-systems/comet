include "test/common.aphel"

include "test/display.aphel"

main:

    call rk, swap_framebuffers

    li   ra, 0x261918
    call rk, display.clear

    li ra, 100
    li rb, 100
    li rc, 0
    li rd, 0
    li re, 0xFFFFFF
    

    .loop:

        add rc, rc, 1
        add rd, rd, 3
        add re, re, 1

        rem rc, rc, display.width
        rem rd, rd, display.height

        call rk, display.rect

        bra .loop

        call rk, swap_framebuffers

        bra .loop

    ret


swap_framebuffers:
    push ra
    push rb
    push rk

    call rk, display.update

    li ra, .current
    lb ra, ra
    cmp ra, 0
    beq .zero
    bra .one

    .zero:
        li rb, .current
        li ra, 1
        sb rb, ra

        li ra, 0x100000
        call rk, display.set_framebuffer
        bra .exit

    .one:
        li rb, .current
        li ra, 0
        sb rb, ra

        li ra, 0x1000000
        call rk, display.set_framebuffer
        bra .exit

    .exit:
        pop rk
        pop rb
        pop ra
        ret

    .current:
        d8 0