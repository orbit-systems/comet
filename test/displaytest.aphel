include "test/common.aphel"

include "test/display.aphel"

main:

    call rk, swap_framebuffers

    li   ra, 0x261918
    call rk, display.clear

    .loop:

        li ra, 100
        li rb, 100
        li rc, 0
        li rd, 0
        li re, 0xFFFFFF
        call rk, display.rect

        li ra, 96
        li rb, 96
        li rc, 2
        li rd, 2
        li re, 0x261918
        call rk, display.rect

        call rk, swap_framebuffers

        bra .loop

    ret


swap_framebuffers:
    push ra
    push rb
    push rk

    call rk, display.update

    li ra, .current
    lb ra, ra
    cmp ra, 0
    beq .zero
    bra .one

    .zero:
        li rb, .current
        li ra, 1
        sb rb, ra

        li ra, 0x100000
        call rk, display.set_framebuffer
        bra .exit

    .one:
        li rb, .current
        li ra, 0
        sb rb, ra

        li ra, 0x1000000
        call rk, display.set_framebuffer
        bra .exit

    .exit:
        pop rk
        pop rb
        pop ra
        ret

    .current:
        d8 0